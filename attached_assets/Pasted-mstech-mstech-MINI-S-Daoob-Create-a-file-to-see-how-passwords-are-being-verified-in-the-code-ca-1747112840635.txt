mstech@mstech-MINI-S:~/Daoob$ # Create a file to see how passwords are being verified in the code
cat > debug-auth.js << 'EOF'
import { db } from './server/db';
import { users } from './shared/schema';
import { scrypt, randomBytes, timingSafeEqual } from 'crypto';
import { promisify } from 'util';
import { eq } from 'drizzle-orm';

const scryptAsync = promisify(scrypt);

// This function should match the one in your auth.ts file
async function comparePasswords(supplied, stored) {
  console.log('Comparing passwords:');
  console.log('- Supplied:', supplied);
  console.log('- Stored:', stored);
  
  try {
    const [hashed, salt] = stored.split('.');
    console.log('- Extracted salt:', salt);
    
    if (!salt) {
      console.error('No salt found in stored password');
      return false;
    }
    
    const hashedBuf = Buffer.from(hashed, 'hex');
    console.log('- Hashed buffer length:', hashedBuf.length);
    
    const suppliedBuf = await scryptAsync(supplied, salt, 64);
    console.log('- Supplied buffer length:', suppliedBuf.length);
    
    const result = timingSafeEqual(hashedBuf, suppliedBuf);
    console.log('- Match result:', result);
    
    return result;
  } catch (error) {
    console.error('Error comparing passwords:', error);
    return false;
  }
}

async function testAuth() {
  try {
    // Test with the known users
    const adminUser = await db.select().from(users).where(eq(users.username, 'admin')).limit(1);
    
    if (adminUser.length === 0) {
      console.log('Admin user not found');
      return;
    }
    
    console.log('Admin user found:', {
      id: adminUser[0].id,
      username: adminUser[0].username,
      passwordFormat: adminUser[0].password.includes('.') ? 'Has salt separator' : 'Missing salt sepnode debug-auth.js'Auth test error:', error); ${result ? 'MATCHES' : 'does NOT match'}`);
node:internal/modules/esm/resolve:283
    throw new ERR_MODULE_NOT_FOUND(
          ^

Error [ERR_MODULE_NOT_FOUND]: Cannot find module '/home/mstech/Daoob/server/db' imported from /home/mstech/Daoob/debug-auth.js
    at finalizeResolution (node:internal/modules/esm/resolve:283:11)
    at moduleResolve (node:internal/modules/esm/resolve:952:10)
    at defaultResolve (node:internal/modules/esm/resolve:1188:11)
    at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:642:12)
    at #cachedDefaultResolve (node:internal/modules/esm/loader:591:25)
    at ModuleLoader.resolve (node:internal/modules/esm/loader:574:38)
    at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:236:38)
    at ModuleJob._link (node:internal/modules/esm/module_job:130:49) {
  code: 'ERR_MODULE_NOT_FOUND',
  url: 'file:///home/mstech/Daoob/server/db'
}

